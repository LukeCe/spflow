<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Define details of the estimation procedure with the spflow() function. — spflow_control • spflow</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Define details of the estimation procedure with the spflow() function. — spflow_control" />
<meta property="og:description" content="This function creates a list to fine tune the estimation of a spatial
interaction model with spflow().
The options allow to adjust the estimation method and give the user full
control over the use of the explanatory variables.
The user can also adjust the form of autocorrelation to be considered." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">spflow</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/paris_commute_flows.html">Home-to-work commuting flows within the municipalities around Paris</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/LukeCe/spflow/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Define details of the estimation procedure with the <code><a href='spflow.html'>spflow()</a></code> function.</h1>
    <small class="dont-index">Source: <a href='https://github.com/LukeCe/spflow/blob/master/R/spflow-control.R'><code>R/spflow-control.R</code></a></small>
    <div class="hidden name"><code>spflow_control.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function creates a list to fine tune the estimation of a spatial
interaction model with <code><a href='spflow.html'>spflow()</a></code>.
The options allow to adjust the estimation method and give the user full
control over the use of the explanatory variables.
The user can also adjust the form of autocorrelation to be considered.</p>
    </div>

    <pre class="usage"><span class='fu'>spflow_control</span><span class='op'>(</span>
  estimation_method <span class='op'>=</span> <span class='st'>"mle"</span>,
  model <span class='op'>=</span> <span class='st'>"model_9"</span>,
  use_intra <span class='op'>=</span> <span class='cn'>TRUE</span>,
  sdm_variables <span class='op'>=</span> <span class='st'>"same"</span>,
  weight_variable <span class='op'>=</span> <span class='cn'>NULL</span>,
  parameter_space <span class='op'>=</span> <span class='st'>"approx"</span>,
  loglik_det_aprox_order <span class='op'>=</span> <span class='fl'>10</span>,
  mle_hessian_method <span class='op'>=</span> <span class='st'>"mixed"</span>,
  mle_optim_limit <span class='op'>=</span> <span class='fl'>100</span>,
  twosls_instrumental_variables <span class='op'>=</span> <span class='st'>"same"</span>,
  twosls_decorrelate_instruments <span class='op'>=</span> <span class='cn'>FALSE</span>,
  twosls_reduce_pair_instruments <span class='op'>=</span> <span class='cn'>TRUE</span>,
  mcmc_iterations <span class='op'>=</span> <span class='fl'>5500</span>,
  mcmc_burn_in <span class='op'>=</span> <span class='fl'>2500</span>,
  mcmc_resampling_limit <span class='op'>=</span> <span class='fl'>100</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>estimation_method</th>
      <td><p>A character which indicates the estimation method, should be one of
<code><a href='https://rdrr.io/r/base/c.html'>c("mle","s2sls","mcmc")</a></code></p></td>
    </tr>
    <tr>
      <th>model</th>
      <td><p>A character indicating the model number,  indicating different spatial
dependence structures (see documentation for details), should be one of
<code><a href='https://rdrr.io/r/base/paste.html'>paste0("model_", 1:9)</a></code></p></td>
    </tr>
    <tr>
      <th>use_intra</th>
      <td><p>A logical which activates the option to use a separate set of parameters
for intra-regional flows (origin == destination)</p></td>
    </tr>
    <tr>
      <th>sdm_variables</th>
      <td><p>Either a formula or a character; the formula can be used to explicitly
declare the variables in SDM specification, the character should be one of
<code><a href='https://rdrr.io/r/base/c.html'>c("same", "all")</a></code> which are short cuts for using all available variables
or the same as used in the main formula provided to <code><a href='spflow.html'>spflow()</a></code></p></td>
    </tr>
    <tr>
      <th>weight_variable</th>
      <td><p>A character indicating the name of one column in the node pair data.</p></td>
    </tr>
    <tr>
      <th>parameter_space</th>
      <td><p>A character indicating how to define the limits of the parameter space.
The only available option is <code><a href='https://rdrr.io/r/base/c.html'>c("approx")</a></code>.</p></td>
    </tr>
    <tr>
      <th>loglik_det_aprox_order</th>
      <td><p>A numeric indicating the order of the Taylor expansion used to approximate
the value of the log-determinant term.</p></td>
    </tr>
    <tr>
      <th>mle_hessian_method</th>
      <td><p>A character which indicates the method for Hessian calculation</p></td>
    </tr>
    <tr>
      <th>mle_optim_limit</th>
      <td><p>A numeric indicating the number of trials given to the optimizer of the
likelihood function. A trial refers to a new initiation of the
optimization procedure using different (random) starting values for the
parameters. If the optimizer does not converge after the
indicated number of trails an error will be thrown after this limit.</p></td>
    </tr>
    <tr>
      <th>twosls_instrumental_variables</th>
      <td><p>Either a formula or a character; the formula can be used to explicitly
declare the variables that should be used as instruments during S2SLS
estimation, the character should be one of <code><a href='https://rdrr.io/r/base/c.html'>c("same", "all")</a></code> which
are short cuts for using all available variables or the same as used in
the main formula provided to <code><a href='spflow.html'>spflow()</a></code></p></td>
    </tr>
    <tr>
      <th>twosls_decorrelate_instruments</th>
      <td><p>A logical whether to perform a PCA to remove (linear) correlation from the
instruments generated for the S2SLS estimator</p></td>
    </tr>
    <tr>
      <th>twosls_reduce_pair_instruments</th>
      <td><p>A logical that indicates whether the number of instruments that are
derived from pair attributes should be reduced or not. The default is
<code>TRUE</code>, because constructing these instruments is often the most demanding
part of the estimation (Dargel 2021)
.</p></td>
    </tr>
    <tr>
      <th>mcmc_iterations</th>
      <td><p>A numeric indicating the number of iterations</p></td>
    </tr>
    <tr>
      <th>mcmc_burn_in</th>
      <td><p>A numeric indicating the length of the burn in period</p></td>
    </tr>
    <tr>
      <th>mcmc_resampling_limit</th>
      <td><p>A numeric indicating the maximal number of trials during rejection
sampling of the autoregressive parameters</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A list of control parameters for estimation via <code><a href='spflow.html'>spflow()</a></code></p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    

<h3 class='hasAnchor' id='arguments'><a class='anchor' href='#arguments'></a>Adjusting the form of autocorrelation</h3>


<p>The option <code>model</code> allows to declare one of nine different forms of
autocorrelation that follow the naming convention of
LeSage and Pace (2008)
.
The most general specification is "model_9", leading to the model
\(y = \rho_dW_dy + \rho_o W_oy + \rho_wW_wy + Z\delta + \epsilon\).
All other models special cases of this one.
The constraints that lead to the different sub models are summarized in
this table.</p><table class='table'>
<tr><td><strong>Model Number</strong></td><td><strong>Autocorrelation Parameters</strong></td><td><strong>Constraints</strong></td></tr>
<tr><td>Model 9</td><td>\(\rho_d, \rho_o, \rho_w\)</td><td>unconstrained</td></tr>
<tr><td>Model 8</td><td>\(\rho_d, \rho_o, \rho_w\)</td><td>\(\rho_w = - \rho_d \rho_o\)</td></tr>
<tr><td>Model 7</td><td>\(\rho_d, \rho_o\)</td><td>\(\rho_w = 0\)</td></tr>
<tr><td>Model 6</td><td>\(\rho_{dow}\)</td><td>\(\rho_d = \rho_o = \rho_w\)</td></tr>
<tr><td>Model 5</td><td>\(\rho_{do}\)</td><td>\(\rho_d = \rho_o, \rho_w = 0\)</td></tr>
<tr><td>Model 4</td><td>\(\rho_w\)</td><td>\(\rho_d = \rho_o = 0\)</td></tr>
<tr><td>Model 3</td><td>\(\rho_o\)</td><td>\(\rho_d = \rho_w = 0\)</td></tr>
<tr><td>Model 2</td><td>\(\rho_d\)</td><td>\(\rho_o = \rho_w = 0\)</td></tr>
<tr><td>Model 1</td><td>none</td><td>\(\rho_d = \rho_o = \rho_w = 0\)</td></tr>
</table>




    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Dargel L (2021).
&#8220;Revisiting Estimation Methods for Spatial Econometric Interaction Models.&#8221;
Toulouse School of Economics.<br /><br /> LeSage JP, Pace RK (2008).
&#8220;Spatial Econometric Modeling of Origin-Destination Flows.&#8221;
<em>Journal of Regional Science</em>, 941--967.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='spflow.html'>spflow()</a></code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='co'># default is MLE estimation of the most comprehensive model</span>
<span class='va'>default_control</span> <span class='op'>&lt;-</span> <span class='fu'>spflow_control</span><span class='op'>(</span><span class='op'>)</span>

<span class='co'># change the estimation method</span>
<span class='va'>custom_control</span> <span class='op'>&lt;-</span> <span class='fu'>spflow_control</span><span class='op'>(</span>estimation_method <span class='op'>=</span> <span class='st'>"mcmc"</span><span class='op'>)</span>

<span class='co'># change the form of autocorrelation to be considered</span>
<span class='va'>custom_control</span> <span class='op'>&lt;-</span> <span class='fu'>spflow_control</span><span class='op'>(</span>model <span class='op'>=</span> <span class='st'>"model_7"</span><span class='op'>)</span>

<span class='co'># declare precisely which variables are to be used in the SDM form</span>
<span class='va'>custom_control</span> <span class='op'>&lt;-</span>
  <span class='fu'>spflow_control</span><span class='op'>(</span>sdm_variables <span class='op'>=</span> <span class='op'>~</span> <span class='fu'>O_</span><span class='op'>(</span><span class='va'>v1</span> <span class='op'>+</span> <span class='va'>v2</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'>D_</span><span class='op'>(</span><span class='va'>v2</span> <span class='op'>+</span> <span class='va'>v3</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'>I_</span><span class='op'>(</span><span class='va'>v1</span> <span class='op'>+</span> <span class='va'>v4</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># deactivate the intra-regional coefficients and SDM variables</span>
<span class='va'>custom_control</span> <span class='op'>&lt;-</span> <span class='fu'>spflow_control</span><span class='op'>(</span>use_intra <span class='op'>=</span> <span class='cn'>FALSE</span>, sdm_variables <span class='op'>=</span> <span class='st'>"none"</span><span class='op'>)</span>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Lukas Dargel, Thibault Laurent.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


