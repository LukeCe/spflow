<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Compute the design matrices used during the estimation with spflow() — derive_spflow_matrices • spflow</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Compute the design matrices used during the estimation with spflow() — derive_spflow_matrices"><meta property="og:description" content="These are internal functions called within the estimation procedure"><meta property="og:image" content="/logo.svg"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">spflow</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0.9010</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/paris_commute_flows.html">Home-to-work commuting flows within the municipalities around Paris</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/LukeCe/spflow/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Compute the design matrices used during the estimation with <code><a href="spflow.html">spflow()</a></code></h1>
    <small class="dont-index">Source: <a href="https://github.com/LukeCe/spflow/blob/HEAD/R/spflow_matrices.R" class="external-link"><code>R/spflow_matrices.R</code></a></small>
    <div class="hidden name"><code>derive_spflow_matrices.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>These are internal functions called within the estimation procedure</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">derive_spflow_matrices</span><span class="op">(</span></span>
<span>  <span class="va">id_net_pair</span>,</span>
<span>  <span class="va">spflow_networks</span>,</span>
<span>  <span class="va">spflow_formula</span>,</span>
<span>  <span class="va">spflow_control</span>,</span>
<span>  na_rm <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="value">
    <h2>Value</h2>
    

<p>A list containing all design matrices required for estimation, impact calculation and prediction</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>The key to an efficient estimation is to preserve the relational
representation of the data for origins, destinations and
origins-destinations pairs.
This requires to be aware of the following;</p><ul><li><p>there are up to three sources of data: OD-pairs &amp; origin-nodes &amp; destination-nodes</p></li>
<li><p>each variable may be used in three different ways: directly &amp; as a spatial lag
(like in the SDM) &amp; as an instrument for the S2SLS estimator</p></li>
<li><p>the model matrices can be split into five groups</p><ol><li><p>"Y_" = OD-flows (the dependent variable, in matrix form)</p></li>
<li><p>"P_" = OD-pair attributes (in matrix form)</p></li>
<li><p>"D_" = destination attributes</p></li>
<li><p>"O_" = origin attributes</p></li>
<li><p>"I_" = intra-regional attributes</p></li>
</ol></li>
</ul><p>The additional separation of model matrices and data-sources makes sense if
the list of origins coincides with the list of destinations.
In this case, we can use data from the same set of nodes as origin,
destination, and intra-regional characteristics and each of these enter
the model in different ways.</p>
<p>The model formula interface in <code><a href="spflow.html">spflow()</a></code> is used to specify, how the variables
in the data-sources are used.
Any transformations of variables are handled by  R's build-in tools and
spatial lags, that are specified in the augments <code>sdm_variables</code> and
<code>twosls_instrumental_variables</code> to <code><a href="spflow_control.html">spflow_control()</a></code> are calculated after
transformations have been applied.
Below is an explanation of the formula parts:</p><ul><li><p>"norm" variables are not lagged</p></li>
<li><p>"sdm" variables are lagged once and used as explanatory variables</p></li>
<li><p>"inst" variables are lagged twice and used as instruments.
If a variable is at the same time as instrument and as sdm-variable we
have to increase the lags-order to avoid multicollinearity issues
(Dargel 2021)
.</p></li>
</ul></div>
    <div id="references">
    <h2>References</h2>
    <p>Dargel L (2021).
“Revisiting estimation methods for spatial econometric interaction models.”
<em>Journal of Spatial Econometrics</em>, 10.
<a href="https://doi.org/10.1007/s43071-021-00016-1" class="external-link">https://doi.org/10.1007/s43071-021-00016-1</a>.</p>
    </div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Lukas Dargel, Thibault Laurent.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

